# 연관관계 매핑의 종류

### 연관관계 매핑 시 고려사항 3가지
1. 다중성
   <br>다대일, 일대다, 일대일, 다대다
   <br>보통 N:N의 경우는 실무에서 사용하는 것을 지양한다.
   <br>N:1 [interface table] 1:N 로 해결하는 것이 좋다
   <br><br>
2. 단방향, 양방향
   <br>- __테이블__
   <br>-- 외래 키 하나로 양쪽 조인 가능
   <br>-- 사실 방향이라는 개ㅁ념이 없음
   <br>
   <br>- __객체__
   <br>--참조용 필드가 있는 쪽으로만 참조 가능
   <br>--한쪽만 참조하면 단방향
   <br>--양쪽이 서로 참조하면 양방향
   <br><br>
3. 연관관계의 주인(양방향)
* 테이블은 외래 키 하나로 두 테이블이 연관관계를 맺음
* 연관관계의 주인 : __외래 키를 관리하는 참조__
* 주인의 반대편 : 오래 키에 영향을 주지 않음, __단순 조회만 됨__

### 다대일(@ManyToOne)
실무에서 __가장 많이 사용__ 하는 관계이다.
<br>Database 설계에서 1:N이라고 한다면 N쪽이 외래키를 관리하는 것이 설계가 잘 된 Database이다.
<br>참조 조회를 위해 __양방향 연관관계__ 를 설정해준다고 해도 Database에 영향을 전혀 주지 않기 때문에 양방향 관계는 개발 중 __필요할 때__ 추가해주면 된다.
<br>

### 일대다(@OneToMany)
1:N 중 __1이 연관관계의 주인__ 이다.
<br>* __일대다 단방향 매핑__
<br>* 권장하는 모델은 아님(표준 스펙에서 지원만 함)
<br>
<br>객체 입장에서는 가능하지만, Database 입장에서는 N쪽에 외래키가 들어갈 수 밖에 없다.
<br>연관관계의 주인에 FK가 있지 않기 때문에 각 테이블에 Insert 이후 FK가 있는 테이블에 Update쿼리를 한 번 더 실행한다.
<br>FK가 없는 연관관계 주인에 데이터를 입력했는데 FK가 있는 테이블에 Update쿼리가 실행돼서 업무에 혼란을 줄 수 있어서, 해당 방법보다는 __양방향 연관관계__ 로 풀어내는 것이 훨씬 좋다.
<br>다만 양방향 연관관계 사용 시 ToString 어노테이션과 같이 서로의 관계 객체를 무한하게 호출하여 무한루프 문제가 발생하는 것을 경계해야한다.
<br>
<br>* 해당 방식을 사용하게 될 경우 반드시 __@JoinColumn__ 어노테이션을 사용해야 한다. 그렇지 않으면 JPA가 테이블 조인 방식을 자동으로 사용한다(중계? 테이블, 조인? 테이블).

### 일대일(@OneToOne)
* 일대일 관계는 __그 반대도 일대일이다.__
* 주 테이블 또는 부(대상) 테이블 둘 중 __아무곳에나 외래키__ 가 존재할 수 있다.
* 오래 키에 데이터베이스 __유니크 제약 조건__ 을 추가해야 한다.
  <br>객체 연관관계
  <br>
  <br>
1. 객체 연관관계

| Member table                          | Locker table |
|---------------------------------------|--------------|
| id<br/>__Locker locker__<br/>username | id<br/>name  |

2. 테이블 연관관계

| Member table                           | Locker table  |
|----------------------------------------|---------------|
| MEMBER_ID(PK)                          | LOCKER_ID(PK) |
| __LOCKER_ID(FK, UNIQUE)__<br/>USERNAME | NAME          |

* 다대일 단방향 매핑과 매우 흡사하다.
* 양방향으로 만들고싶다면 Locker에 Member를 추가하면 된다.
* 일대일 관계에서는 __내 엔티티에 있는 외래키를 직접 관리해야 한다.__
  

비즈니스 룰이 추후에 바뀌게 된다면...?  
1. 락커 하나가 여러 개의 멤버를 가질 수 있다면?  
2. 하나의 멤버가 여러 개의 락커를 가질 수 있다면?   
을 고려했을 때...
  
   
### 다대다(@ManyToMany)
* 관계형 데이터베이스는 정규화 된 테이블 2개로 다대다 관계를 표현할 수 __없다__
* 실무에서 사용하는 것을 __극히 지양__ 하는 연관관계 매핑이다.
* 중간에 __연결 테이블__을 추가해서 일대다, 다대일 관계로 풀어내야 함

| Member table  | Member_Locker table                             |Locker table|
|---------------|-------------------------------------------------|---------------|
| MEMBER_ID(PK) | __MEMBER_ID(PK, FK)__<br/>__LOCKER_ID(PK, FK)__ | LOCKER_ID(PK) |
| USERNAME      |                                                 | NAME          |

* @ManyToMany를 사용
* @JoinTable로 연결 테이블 지정
  
JPA는 Hello World가 아니다... 그냥 연결만 하고 사용한다는건 Hello World 찍어본다는 이야기다.  
실무에서 만나는 테이블은 위 예제처럼 단순하게 설계되지 않는다...  
정 사용해야한다면 중간 테이블을 Entity로 격상시켜서 실제 테이블로 활용하는 것이 맞다.

### 다양한 연간관계 매핑

